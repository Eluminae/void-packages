create_user() {
	echo ">>> Creating monkeysphere user and group and setting permissions..."
	getent group monkeysphere >/dev/null || groupadd -r monkeysphere
	getent passwd monkeysphere >/dev/null ||useradd -r -c 'Monkeysphere WoT server identification tool' -g monkeysphere -d '/var/lib/monkeysphere' -s /bin/bash monkeysphere
}

transition() {
	echo ">>> Trying all available transitions..."
	for trans in 0.23 0.28 ; do
		/usr/share/monkeysphere/transitions/$trans || { \
			RET=$?
			echo "Failed running transition script /usr/share/monkeysphere/transitions/$trans" >&2
			exit $RET
		}
	done
}

case "$ACTION" in
	post)
	if [ "$UPDATE" = "yes" ]; then
		transition
	else
		create_user
		transition
	fi
	;;
esac
